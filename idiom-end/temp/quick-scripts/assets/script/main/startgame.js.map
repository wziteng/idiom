{"version":3,"sources":["startgame.js"],"names":["golbal","require","cc","Class","extends","Component","properties","progressBar","type","Node","default","is_loading","onLoad","self","pro","getComponent","ProgressBar","progress","Over","ProBar","beginGame","node","on","schedule","callback","unschedule","director","loadScene","getAuth","window","wx","login","success","res","code","sendCodePost","getUserInfo","console","log","sendUserInfo","openid","preloadScene","emit","sysInfo","getSystemInfoSync","width","screenWidth","height","screenHeight","getSetting","authSetting","button","createUserInfoButton","text","style","left","top","backgroundColor","color","fontSize","textAlign","lineHeight","onTap","userInfo","destroy"],"mappings":"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","file":"startgame.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\main","sourcesContent":["let golbal = require('Global');\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        progressBar: {\r\n            type: cc.Node,\r\n            default: null,\r\n        },\r\n        is_loading: false,\r\n\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad() {\r\n        let self = this;\r\n        this.pro = this.progressBar.getComponent(cc.ProgressBar);\r\n        this.pro.progress = 0;\r\n        this.Over();\r\n        this.ProBar();\r\n        this.beginGame();\r\n\r\n    },\r\n\r\n    ProBar() {\r\n        let self = this;\r\n        this.node.on('probar', function () {\r\n            self.schedule(self.callback, 0.7);\r\n        })\r\n    },\r\n\r\n    callback() {\r\n        let self = this;\r\n        if (self.pro.progress < 1) {\r\n            self.pro.progress = self.pro.progress + 0.1;\r\n        } else {\r\n            self.unschedule(self.callback);\r\n        }\r\n    },\r\n\r\n    Over() {\r\n        this.node.on('over', function () {\r\n            cc.director.loadScene('main');\r\n        })\r\n    },\r\n\r\n    getAuth() {\r\n        let self=this;\r\n        window.wx.login({\r\n            success: function (res) {\r\n                let code = res.code;\r\n                golbal.sendCodePost(code, () => {\r\n                    window.wx.getUserInfo({\r\n                        success(res) {\r\n                            console.log(res);\r\n                            golbal.sendUserInfo(res, golbal.openid);//res:用户信息，openid：用户的openid\r\n                            cc.director.preloadScene('main', () => {\r\n                                console.log('加载完成！');\r\n                                self.node.emit('over');\r\n                            })\r\n                        }\r\n                    });\r\n                });\r\n\r\n            }\r\n        });\r\n    },\r\n\r\n\r\n    beginGame() {\r\n        let self = this;\r\n        let sysInfo = window.wx.getSystemInfoSync();\r\n        //获取微信界面大小\r\n        let width = sysInfo.screenWidth;\r\n        let height = sysInfo.screenHeight;\r\n        window.wx.getSetting({\r\n            success(res) {\r\n                console.log(res.authSetting);\r\n                if (res.authSetting[\"scope.userInfo\"]) {\r\n                    self.node.emit('probar');\r\n                    self.getAuth();\r\n                } else {\r\n                    let button = window.wx.createUserInfoButton({\r\n                        type: 'text',\r\n                        text: '',\r\n                        style: {\r\n                            left: 0,\r\n                            top: 0,\r\n                            width: width,\r\n                            height: height,\r\n                            backgroundColor: '#00000000',//最后两位为透明度\r\n                            color: '#ffffff',\r\n                            fontSize: 20,\r\n                            textAlign: \"center\",\r\n                            lineHeight: height,\r\n                        }\r\n                    });\r\n                    button.onTap((res) => {\r\n                        if (res.userInfo) {\r\n                            console.log('授权');\r\n                            self.node.emit('probar');\r\n                            self.getAuth();\r\n                            button.destroy();\r\n\r\n                        } else {\r\n                            console.log(\"用户拒绝授权:\", res);\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        })\r\n    },\r\n\r\n    //update (dt) { },\r\n});\r\n"]}