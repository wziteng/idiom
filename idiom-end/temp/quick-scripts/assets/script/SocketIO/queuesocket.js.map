{"version":3,"sources":["queuesocket.js"],"names":["global","require","sdk","Constants","STAND","cc","Class","extends","Component","properties","user_1_avatar","Sprite","user_1_nickname","Label","user_2_avatar","user_2_nickname","onLoad","self","console","log","nickName","avatar","queueSocket","io","connect","on","stand","BLACK","showUserINfo","WHITE","roomId","roomSocket","disconnect","emit","name1","avatar1","name2","avatar2","load","schedule","sendHttpPost","director","loadScene","sprite","avatarUrl","createImage","string","closePrefab","prefab","prename","destroy","globalSocket","hallSocket","start"],"mappings":";;;;;;AAAA,IAAIA,SAASC,QAAQ,QAAR,CAAb;AACA,IAAIC,MAAID,QAAQ,KAAR,CAAR;AACA,IAAME,YAAYF,QAAQ,WAAR,CAAlB;AACA,IAAMG,QAAQD,UAAUC,KAAxB;AACAC,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;AAELC,gBAAY;AACRC,uBAAcL,GAAGM,MADT;AAERC,yBAAgBP,GAAGQ,KAFX;AAGRC,uBAAcT,GAAGM,MAHT;AAIRI,yBAAgBV,GAAGQ;AAJX,KAFP;AAQL;AACAG,UATK,oBASI;AACL,YAAIC,OAAK,IAAT;;AAEAC,gBAAQC,GAAR,CAAY,SAAOnB,OAAOoB,QAA1B;AACAF,gBAAQC,GAAR,CAAY,SAAOnB,OAAOqB,MAA1B;AACArB,eAAOsB,WAAP,GAAqBC,GAAGC,OAAH,CAAW,gCAAX,EAA6C,EAAE,wBAAwB,IAA1B,EAA7C,CAArB,CALK,CAK+F;;AAEpGxB,eAAOsB,WAAP,CAAmBG,EAAnB,CAAsB,WAAtB,EAAmC,UAAUC,KAAV,EAAiB;AAChD,gBAAIA,UAAU,OAAd,EAAuB;AAAC;AACpB1B,uBAAO0B,KAAP,GAAetB,MAAMuB,KAArB;AACAV,qBAAKW,YAAL,CAAkBX,KAAKP,aAAvB,EAAqCV,OAAOqB,MAA5C,EAAmDJ,KAAKL,eAAxD,EAAwEZ,OAAOoB,QAA/E,EAFmB,CAEsE;AAC5F,aAHD,MAIK,IAAIM,UAAU,OAAd,EAAuB;AAAC;AACzB1B,uBAAO0B,KAAP,GAAetB,MAAMyB,KAArB;AACAZ,qBAAKW,YAAL,CAAkBX,KAAKH,aAAvB,EAAqCd,OAAOqB,MAA5C,EAAmDJ,KAAKF,eAAxD,EAAwEf,OAAOoB,QAA/E,EAFwB,CAEiE;AAC5F;AACJ,SATD;;AAWA;AACApB,eAAOsB,WAAP,CAAmBG,EAAnB,CAAsB,eAAtB,EAAuC,UAAUK,MAAV,EAAkB;AACrDzB,eAAGc,GAAH,CAAO,kBAAkBW,MAAzB;AACAzB,eAAGc,GAAH,CAAO,OAAOnB,OAAO0B,KAArB;AACA1B,mBAAO+B,UAAP,GAAoBR,GAAGC,OAAH,CAAW,mCAAmCM,MAA9C,EAAsD,EAAE,wBAAwB,IAA1B,EAAtD,CAApB;AACA9B,mBAAOsB,WAAP,CAAmBU,UAAnB;AACAhC,mBAAO+B,UAAP,CAAkBE,IAAlB,CAAuB,WAAvB,EAAoCjC,OAAOoB,QAA3C,EAAoDpB,OAAOqB,MAA3D,EALqD,CAKc;AACnErB,mBAAO+B,UAAP,CAAkBE,IAAlB,CAAuB,MAAvB,EAA8B,CAA9B;AACAjC,mBAAO+B,UAAP,CAAkBN,EAAlB,CAAqB,SAArB,EAA+B,UAASS,KAAT,EAAeC,OAAf,EAAuBC,KAAvB,EAA6BC,OAA7B,EAAqC;AAChEnB,wBAAQC,GAAR,CAAYnB,OAAO0B,KAAnB;AACAR,wBAAQC,GAAR,CAAYe,KAAZ;AACAhB,wBAAQC,GAAR,CAAYiB,KAAZ;AACAlB,wBAAQC,GAAR,CAAYgB,OAAZ;AACAjB,wBAAQC,GAAR,CAAYkB,OAAZ;AACA,oBAAGrC,OAAO0B,KAAP,KAAe,EAAlB,EAAqB;AAAC;AAClBR,4BAAQC,GAAR,CAAY,KAAZ;AACAF,yBAAKW,YAAL,CAAkBX,KAAKH,aAAvB,EAAqCqB,OAArC,EAA6ClB,KAAKF,eAAlD,EAAkEmB,KAAlE;AACAjB,yBAAKqB,IAAL;AACH,iBAJD,MAIK;AAAC;AACFpB,4BAAQC,GAAR,CAAY,KAAZ;AACAF,yBAAKW,YAAL,CAAkBX,KAAKP,aAAvB,EAAqC2B,OAArC,EAA6CpB,KAAKL,eAAlD,EAAkEwB,KAAlE;AACAnB,yBAAKqB,IAAL;AACH;AACJ,aAfD;AAkBH,SAzBD;AA0BH,KAtDI;AAwDLA,QAxDK,kBAwDC;AACF,YAAIrB,OAAK,IAAT;AACAA,aAAKsB,QAAL,CAAc,YAAU;AACpBvC,mBAAOwC,YAAP,CAAoB,YAAI;AACpBnC,mBAAGoC,QAAH,CAAYC,SAAZ,CAAsB,UAAtB;AACH,aAFD;AAGH,SAJD,EAIE,GAJF;AAKH,KA/DI;AAiELd,gBAjEK,wBAiEQe,MAjER,EAiEeC,SAjEf,EAiEyB/B,KAjEzB,EAiE+BO,QAjE/B,EAiEwC;AAAC;AAC1ClB,YAAI2C,WAAJ,CAAgBF,MAAhB,EAAuBC,SAAvB;AACA/B,cAAMiC,MAAN,GAAa1B,QAAb;AACH,KApEI;AAwEL2B,eAxEK,yBAwES;AACV/C,eAAOsB,WAAP,CAAmBU,UAAnB;AACA,YAAIgB,SAAShD,OAAOiD,OAApB;AACAD,eAAOE,OAAP;AACAlD,eAAOsB,WAAP,CAAmBU,UAAnB;AACAhC,eAAOmD,YAAP,GAAsB5B,GAAGC,OAAH,CAAW,0BAAX,CAAtB;AACAxB,eAAOoD,UAAP,GAAoB7B,GAAGC,OAAH,CAAW,+BAAX,EAA4C,EAAE,wBAAwB,IAA1B,EAA5C,CAApB;AACH,KA/EI;AAmFL6B,SAnFK,mBAmFG,CAEP;AArFI;;AAuFL;AAvFJ","file":"queuesocket.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\SocketIO","sourcesContent":["let global = require('Global');\r\nlet sdk=require('sdk');\r\nconst Constants = require('Constants');\r\nconst STAND = Constants.STAND;\r\ncc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        user_1_avatar:cc.Sprite,\r\n        user_1_nickname:cc.Label,\r\n        user_2_avatar:cc.Sprite,\r\n        user_2_nickname:cc.Label,\r\n    },\r\n    // LIFE-CYCLE CALLBACKS:\r\n    onLoad() {\r\n        let self=this;\r\n\r\n        console.log('玩家头像'+global.nickName);\r\n        console.log('玩家昵称'+global.avatar);\r\n        global.queueSocket = io.connect('wss://game.i--j.com:3002/queue', { 'force new connection': true });//wss://game.i--j.com:3002\r\n\r\n        global.queueSocket.on('set stand', function (stand) {\r\n            if (stand === 'black') {//玩家一\r\n                global.stand = STAND.BLACK;\r\n                self.showUserINfo(self.user_1_avatar,global.avatar,self.user_1_nickname,global.nickName);//显示玩家自己的头像信息\r\n            }\r\n            else if (stand === 'white') {//玩家二\r\n                global.stand = STAND.WHITE;\r\n                self.showUserINfo(self.user_2_avatar,global.avatar,self.user_2_nickname,global.nickName);//显示玩家自己的头像信息\r\n            }\r\n        });\r\n        \r\n        //匹配成功进入房间\r\n        global.queueSocket.on('match success', function (roomId) {\r\n            cc.log('match success' + roomId);\r\n            cc.log('我是' + global.stand);\r\n            global.roomSocket = io.connect('wss://game.i--j.com:3002/rooms' + roomId, { 'force new connection': true });\r\n            global.queueSocket.disconnect();\r\n            global.roomSocket.emit('match_sss', global.nickName,global.avatar);//将玩家的昵称和头像发送给服务器global.nickName,global.avatar\r\n            global.roomSocket.emit('type',0);           \r\n            global.roomSocket.on('userAll',function(name1,avatar1,name2,avatar2){\r\n                console.log(global.stand);\r\n                console.log(name1);\r\n                console.log(name2);\r\n                console.log(avatar1);\r\n                console.log(avatar2);\r\n                if(global.stand===47){//玩家一\r\n                    console.log('玩家一');\r\n                    self.showUserINfo(self.user_2_avatar,avatar1,self.user_2_nickname,name1);\r\n                    self.load();\r\n                }else{//玩家二\r\n                    console.log('玩家二');\r\n                    self.showUserINfo(self.user_1_avatar,avatar2,self.user_1_nickname,name2);\r\n                    self.load();\r\n                }\r\n            });\r\n           \r\n           \r\n        })\r\n    },\r\n\r\n    load(){\r\n        let self=this;\r\n        self.schedule(function(){\r\n            global.sendHttpPost(()=>{\r\n                cc.director.loadScene(\"tiaozhan\");\r\n            })\r\n        },1.5);\r\n    },\r\n\r\n    showUserINfo(sprite,avatarUrl,Label,nickName){//用来远程加载用户的头像和昵称\r\n        sdk.createImage(sprite,avatarUrl);\r\n        Label.string=nickName;\r\n    },\r\n\r\n\r\n\r\n    closePrefab() {\r\n        global.queueSocket.disconnect();\r\n        let prefab = global.prename;\r\n        prefab.destroy();\r\n        global.queueSocket.disconnect();\r\n        global.globalSocket = io.connect('wss://game.i--j.com:3002');\r\n        global.hallSocket = io.connect('wss://game.i--j.com:3002/hall', { 'force new connection': true });\r\n    },\r\n\r\n\r\n\r\n    start() {\r\n\r\n    },\r\n\r\n    // update (dt) {},\r\n});\r\n"]}